# Story 1.4: Onboarding Flow - Profile & Archetype Selection

**Epic:** 1 - Foundation & Core Loop Setup
**Story Points:** 5
**Status:** ✅ Complete (November 19, 2025)

## User Story

**As a** New User,
**I want** to be guided through creating a basic profile (optional login) and selecting my desired Fitness Archetype (Trainer, Runner, Yoga, Bodybuilder, Cyclist),
**so that** I can begin personalizing my experience.

## Acceptance Criteria

1. [x] A multi-step onboarding UI flow is presented on first launch, following the retro aesthetic (NFR6)
2. [x] User can create a profile (or choose to defer login)
3. [x] User is presented with the five Fitness Archetype options
4. [x] User selection of an archetype is recorded and associated with their profile
5. [x] The onboarding flow transitions smoothly between steps

**All acceptance criteria met and verified on iOS simulator (November 19, 2025)**

## Implementation Tasks

### 1. Create Onboarding Screens

**Files to Create:**
- `apps/mobile-shell/src/screens/onboarding/WelcomeScreen.tsx`
- `apps/mobile-shell/src/screens/onboarding/ProfileSetupScreen.tsx`
- `apps/mobile-shell/src/screens/onboarding/ArchetypeSelectionScreen.tsx`
- `apps/mobile-shell/src/navigation/OnboardingNavigator.tsx`

### 2. Fitness Archetypes

**Options:**
1. **Trainer** - Balanced fitness, variety of exercises
2. **Runner** - Cardio-focused, endurance
3. **Yoga** - Flexibility and mindfulness
4. **Bodybuilder** - Strength training, muscle building
5. **Cyclist** - Cycling-focused endurance

Each archetype will have:
- Unique pixel art icon/sprite
- Description text
- Color scheme
- Default stat bonuses for combat character

### 3. Onboarding Flow Steps

1. **Welcome Screen**
   - App logo and tagline
   - "Get Started" button
   - "I already have an account" link

2. **Profile Setup**
   - Username input (3-20 chars, alphanumeric + underscore)
   - Display name (optional)
   - "Create Account" or "Skip for now" (deferred auth)

3. **Archetype Selection**
   - Grid/carousel of 5 archetypes
   - Tap to select
   - Visual feedback on selection
   - "Continue" button

4. **Transition to Story 1.5** (Photo Upload)

### 4. Onboarding Store

**File:** `apps/mobile-shell/src/stores/onboardingStore.ts`

```typescript
interface OnboardingState {
  currentStep: number;
  username: string | null;
  displayName: string | null;
  selectedArchetype: FitnessArchetype | null;
  isComplete: boolean;

  setUsername(username: string): void;
  setDisplayName(name: string): void;
  selectArchetype(archetype: FitnessArchetype): void;
  nextStep(): void;
  previousStep(): void;
  completeOnboarding(): Promise<void>;
}
```

### 5. Design Specifications

**Game Boy Aesthetic:**
- DMG Color Palette (4-color grayscale)
- Pixel art icons (16x16 or 32x32)
- Retro button styling
- CRT screen effect (optional)

**Archetype Cards:**
- 80x80px pixel art character preview
- Archetype name in retro font
- 2-3 line description
- Highlighted border when selected

## User Flow Diagram

```
Welcome Screen
     ↓
Create Account?
   ↙    ↘
 Yes    Skip (Deferred)
   ↓      ↓
Profile Setup
   ↓
Archetype Selection
   ↓
(Story 1.5: Photo Upload)
```

## Database Updates

When archetype is selected, update user profile:

```typescript
await supabase
  .from('user_profiles')
  .update({
    fitness_archetype: selectedArchetype,
    onboarding_completed: false, // Not complete until photo uploaded
  })
  .eq('id', userId);
```

## Testing

- Test all 5 archetype selections
- Test deferred auth flow
- Test back button navigation
- Verify data persistence
- Test with/without keyboard

## Dependencies

- Story 1.2 (Auth) must be complete
- React Navigation
- Zustand (onboarding store)

## Next Story

**Story 1.5:** Onboarding Flow - Photo Upload & AI Avatar Generation

---

## ✅ Completion Summary (November 19, 2025)

### Implementation Status: COMPLETE

**Implemented Screens:**
- ✅ `WelcomeScreen.tsx` - Logo, tagline, GET STARTED button, deferred auth option
- ✅ `ProfileSetupScreen.tsx` - Username input, display name, validation, skip option
- ✅ `ArchetypeSelectionScreen.tsx` - 5 archetype cards with pixel art avatars
- ✅ `OnboardingNavigator.tsx` - React Navigation stack with custom transitions

**Components Used:**
- ✅ **Atomic:** PixelButton, PixelText, PixelInput, PixelSprite, PixelBorder
- ✅ **Molecular:** ArchetypeCard, ProgressIndicator

**Features Implemented:**
- ✅ Multi-step onboarding flow (3 steps: Welcome → Profile → Archetype)
- ✅ Progress indicator showing "Step X of 3"
- ✅ Smooth screen transitions (300ms slide-in with fade)
- ✅ Deferred authentication (skip account creation)
- ✅ Archetype selection with visual feedback (scale + border animations)
- ✅ LCD 4-color design system (strict palette compliance)
- ✅ Press Start 2P + Montserrat font rendering
- ✅ Accessibility labels and ARIA compliance

**Blockers Resolved:**
- ✅ Node version mismatch (v22 → v18.20.8 using fnm)
- ✅ Metro cache cleared
- ✅ iOS simulator build successful

**Verification:**
- ✅ iOS simulator tested on iPhone 15 Pro
- ✅ All 3 screens render correctly
- ✅ Navigation flow works
- ✅ Archetype selection UI functional
- ✅ Screenshots captured showing working implementation

**Next Steps:**
- Proceed to Story 1.5 (Photo Upload & AI Avatar Generation)
- All required components available (FormField, LoadingSpinner)
