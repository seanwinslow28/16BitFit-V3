# Story 1.1: Project Initialization & Core Dependencies

## Status
Draft

## Story
**As a** Developer,
**I want** to initialize the React Native project structure (Monorepo setup TBD by Architect) and install core dependencies (React Native, Phaser, Supabase client, Navigation, Reanimated, Skia),
**so that** the foundational codebase is established for subsequent features.

## Acceptance Criteria
1. React Native project is initialized using the specified version (e.g., 0.71.8+).
2. Core dependencies (Phaser 3.70.0+, Supabase client, React Navigation, Reanimated 4, react-native-skia) are installed and configured.
3. Basic project structure (potentially within a Monorepo) is created following architectural guidance.
4. The application builds and runs successfully on both iOS simulator and Android emulator, displaying a placeholder screen.
5. Basic linting and formatting rules are configured.

## Tasks / Subtasks

- [ ] **Task 1: Initialize Nx Monorepo** (AC: 3)
  - [ ] Install Nx CLI globally or use npx
  - [ ] Create new Nx workspace with React Native preset (or empty preset then add RN)
  - [ ] Configure nx.json with appropriate build/test targets
  - [ ] Create basic folder structure: apps/, packages/, supabase/, docs/, tools/
  - [ ] Add root package.json with workspace configuration
  - [ ] Configure tsconfig.base.json for workspace-wide TypeScript settings

- [ ] **Task 2: Initialize React Native Mobile Shell App** (AC: 1, 4)
  - [ ] Create apps/mobile-shell using React Native 0.71.8
  - [ ] Configure metro.config.js to work with Nx monorepo structure
  - [ ] Set up iOS and Android native projects
  - [ ] Verify builds on both iOS simulator and Android emulator
  - [ ] Create a placeholder HomeScreen component displaying "16BitFit Shell Ready"

- [ ] **Task 3: Install Core Frontend Dependencies** (AC: 2)
  - [ ] Install @supabase/supabase-js (latest)
  - [ ] Install @react-navigation/native (~6.x.x) and @react-navigation/bottom-tabs
  - [ ] Install react-native-reanimated (~4.x.x) and configure Babel plugin
  - [ ] Install @shopify/react-native-skia (~1.x.x)
  - [ ] Install nativewind (~4.x.x) and configure for RN
  - [ ] Install zustand (~4.x.x) for state management
  - [ ] Verify all native dependencies are linked correctly (iOS pods, Android gradle)

- [ ] **Task 4: Set Up Game Engine Package Structure** (AC: 3)
  - [ ] Create apps/game-engine directory
  - [ ] Install phaser@~3.70.0 in game-engine package
  - [ ] Create basic webpack/build configuration for Phaser bundle
  - [ ] Add placeholder Phaser game scene (PreloadScene)
  - [ ] Configure game-engine to output bundled JS for WebView consumption

- [ ] **Task 5: Create Shared Packages** (AC: 3)
  - [ ] Create packages/shared-types with basic TypeScript interfaces
  - [ ] Create packages/bridge-interface for bridge protocol definitions
  - [ ] Create packages/ui-components for shared React Native UI components
  - [ ] Configure TypeScript path aliases in tsconfig.base.json (@packages/*)
  - [ ] Add basic index.ts exports for each package

- [ ] **Task 6: Set Up Supabase Functions Structure** (AC: 3)
  - [ ] Create apps/supabase-functions directory
  - [ ] Add deno.json configuration file
  - [ ] Create supabase/ directory with migrations/ subdirectory
  - [ ] Create placeholder config.toml for Supabase local development
  - [ ] Add shared/ directory for common Edge Function utilities

- [ ] **Task 7: Configure Linting & Formatting** (AC: 5)
  - [ ] Install ESLint and configure for TypeScript/React Native
  - [ ] Install Prettier and create .prettierrc configuration
  - [ ] Add ESLint rules for code quality and React/RN best practices
  - [ ] Configure lint-staged and husky for pre-commit hooks
  - [ ] Add npm scripts for lint, format, and type-check to root package.json

- [ ] **Task 8: Configure MCP (Model Context Protocol) Connectors**
  - [ ] **Essential MCP Connectors:**
    - [ ] **Filesystem MCP** (Highest Priority)
      - [ ] Verify Filesystem MCP is available in both Claude Desktop and Claude Code
      - [ ] Test file read/write operations across project directories
      - [ ] Confirm access to all workspace folders (apps/, packages/, supabase/)
    - [ ] **GitHub MCP** (High Priority)
      - [ ] Configure GitHub MCP connector
      - [ ] Create .env file in project root for storing MCP credentials
      - [ ] Add GITHUB_TOKEN to .env (user will provide token)
      - [ ] Test GitHub operations (repo access, branch creation, commits)
      - [ ] Add .env to .gitignore to prevent credential exposure
    - [ ] **Firecrawl MCP** (High Priority)
      - [ ] Configure Firecrawl MCP connector (for documentation research)
      - [ ] Add FIRECRAWL_API_KEY to .env (user will provide key)
      - [ ] Test web scraping capabilities with React Native docs
      - [ ] Document Firecrawl usage for researching: React Native v0.71.8+, Phaser 3 v3.70.0, Supabase, NativeWind v4, Reanimated 4, react-native-skia
    - [ ] **Context7 MCP**
      - [ ] Add Context7 MCP server using: `claude mcp add --transport http context7 https://mcp.context7.com/mcp --header "CONTEXT7_API_KEY: your_context7_api_key_here"`
      - [ ] Verify library-specific documentation access for: @react-native/ packages, phaser v3.70.0, zustand v4.x, react-navigation v6.x
  - [ ] **Optional MCP Connectors:**
    - [ ] **Figma MCP** (If design files available)
      - [ ] Add FIGMA_ACCESS_TOKEN to .env if Figma designs exist (user will provide)
      - [ ] Configure Figma connector for design file inspection
      - [ ] Test access to 16BitFit prototype designs and comments
    - [ ] **Chrome DevTools MCP** (For WebView debugging)
      - [ ] Configure Chrome DevTools MCP for hybrid bridge debugging
      - [ ] Document usage for inspecting Phaser game engine in WebView
  - [ ] Create comprehensive .env.example file documenting all required MCP credentials
  - [ ] Document all MCP connector setup and usage in project README
  - [ ] Verify all essential MCP connectors are operational before completing story

- [ ] **Task 9: Create Basic Mobile Shell Project Structure** (AC: 3, 4)
  - [ ] Create apps/mobile-shell/src/ with subdirectories:
    - [ ] components/ (atoms/, molecules/, organisms/)
    - [ ] features/ (onboarding/, home/, profile/, settings/)
    - [ ] screens/ (HomeScreen.tsx)
    - [ ] navigation/
    - [ ] services/ (supabaseClient.ts placeholder)
    - [ ] stores/ (index.ts)
    - [ ] styles/
    - [ ] hooks/
    - [ ] bridge/
    - [ ] utils/
  - [ ] Add placeholder files in each directory with basic TypeScript exports

- [ ] **Task 10: Write Unit Tests for Project Setup** (AC: 1, 2, 4)
  - [ ] Install Jest and React Native Testing Library
  - [ ] Configure Jest for React Native in apps/mobile-shell
  - [ ] Write test for placeholder HomeScreen component render
  - [ ] Write test verifying core dependencies are importable
  - [ ] Add test scripts to package.json

- [ ] **Task 11: Verify End-to-End Build Process** (AC: 4)
  - [ ] Run iOS build and launch in simulator
  - [ ] Run Android build and launch in emulator
  - [ ] Verify placeholder screen displays correctly on both platforms
  - [ ] Document any platform-specific configuration needed
  - [ ] Create README.md in root with setup and build instructions

## Dev Notes

### Previous Story Insights
This is the first story in the project, so there are no previous story insights.

### Tech Stack Requirements
[Source: docs/architecture/tech-stack.md]

**Frontend:**
- React Native: ~0.71.8 (Cross-platform mobile shell)
- TypeScript: ~5.x.x (Type safety, developer experience)
- Phaser 3: ~3.70.0 (2D Combat Engine within WebView)
- Zustand: ~4.x.x (Simple, lightweight global state)
- React Navigation: ~6.x.x (Navigation within RN shell)
- Reanimated: ~4.x.x (Performant UI animations, V4 offers worklets)
- react-native-skia: ~1.x.x (Custom pixel rendering/effects)
- NativeWind: ~4.x.x (Utility-first styling, Tailwind-like for RN)

**Backend:**
- Supabase: Cloud Hosted (BaaS - DB, Auth, Realtime, Functions, Storage)
- PostgreSQL: Supabase Hosted (Primary data storage)
- Edge Functions: TypeScript on Deno Runtime
- Database Functions: PL/pgSQL

**Build & Testing:**
- Metro: RN Default (React Native Bundler)
- Jest + RNTL: Latest Stable (Unit/Integration Testing)
- Nx: Monorepo management

### Project Structure
[Source: docs/architecture/unified-project-structure.md]

The project follows an **Nx-managed monorepo** structure:

```
16bitfit-v3-mono/
├── apps/
│   ├── mobile-shell/      # React Native
│   ├── game-engine/       # Phaser config/build
│   └── supabase-functions/# Edge Functions
├── packages/
│   ├── shared-types/      # TS Interfaces
│   ├── bridge-interface/  # Bridge Protocol Defs
│   └── ui-components/     # RN UI Components
├── supabase/
│   ├── migrations/        # DB Schema & PG Functions
│   └── config.toml        # Supabase local config
├── docs/                  # Documentation
├── tools/                 # Scripts
├── nx.json                # Nx Config
├── package.json           # Root Deps
├── tsconfig.base.json     # Base TS Config
└── README.md
```

**Mobile Shell Internal Structure:**
[Source: docs/architecture/frontend-architecture.md#component-organization]

```
apps/mobile-shell/
└── src/
    ├── components/         # Shared, reusable UI components
    │   ├── atoms/
    │   ├── molecules/
    │   └── organisms/
    ├── features/           # Feature-specific components and logic
    │   ├── onboarding/
    │   ├── home/
    │   ├── profile/
    │   └── settings/
    ├── screens/            # Top-level screen components
    ├── navigation/         # Navigation configuration
    ├── services/           # API interaction layer
    ├── stores/             # Zustand state management
    ├── styles/             # Global styles, NativeWind config, Fonts
    ├── hooks/              # Reusable custom hooks
    ├── bridge/             # WebSocket Bridge client logic
    └── utils/              # Utility functions
```

**Supabase Functions Structure:**
[Source: docs/architecture/backend-architecture.md#function-organization]

```
apps/supabase-functions/
├── avatar-generator/
│   └── index.ts
├── record-workout/
│   └── index.ts
├── shared/
└── deno.json
```

### Coding Standards
[Source: docs/architecture/coding-standards.md]

**Critical Rules:**
- Type Sharing: Use packages/shared-types exclusively
- API Calls (FE): Use apps/mobile-shell/src/services/ layer
- Env Vars: Access via config modules only
- Error Handling: Follow defined strategy
- State Updates (FE): Immutable updates only

**Naming Conventions:**
- Components (React): PascalCase (e.g., UserProfileCard.tsx)
- Hooks (React): camelCase with usePrefix (e.g., useFitnessData.ts)
- Service Files: camelCase (e.g., userService.ts)
- State Stores: camelCase with useSuffix (e.g., userStore.ts)
- Edge Functions (Dir): kebab-case (e.g., avatar-generator/)
- Variables/Functions: camelCase (e.g., getUserProfile, totalSteps)
- Types/Interfaces: PascalCase (e.g., UserProfile, DailySteps)

### Testing

[Source: docs/architecture/testing-strategy.md]

**Test Organization:**
Tests co-located or in dedicated folders within apps and packages. E2E tests in apps/mobile-shell/e2e/.

**Frontend Tests (React Native Shell):**
- Framework: Jest + React Native Testing Library (RNTL)
- File Pattern: *.test.tsx or *.test.ts
- Location: Co-located with components or in __tests__/ directories

**Backend Tests (Supabase Edge Functions):**
- Framework: Deno Testing + SuperDeno
- File Pattern: *.test.ts
- Location: Within apps/supabase-functions/

**Backend Tests (PostgreSQL Functions):**
- Framework: pgTAP
- File Pattern: *.test.sql
- Location: Alongside migrations in supabase/migrations/

**Testing Pyramid:**
Manual QA > E2E (Detox/Maestro) > Integration (RNTL / SuperDeno) > Unit (Jest / Deno / pgTAP)

**For This Story:**
- Write basic Jest tests to verify:
  - React Native environment is initialized correctly
  - Core dependencies can be imported without errors
  - Placeholder components render without crashing
- Test file should be at: apps/mobile-shell/src/screens/__tests__/HomeScreen.test.tsx

### Configuration Notes

**React Native 0.71.8:**
- Use React Native CLI for app initialization within Nx workspace
- Configure Metro bundler to support monorepo structure
- May need to adjust metro.config.js to resolve workspace packages

**Reanimated 4 Setup:**
- Requires Babel plugin configuration in babel.config.js
- Add 'react-native-reanimated/plugin' as last item in plugins array

**NativeWind 4:**
- Requires Tailwind CSS configuration
- Configure tailwind.config.js with custom theme for Game Boy palettes (to be added in UI story)
- Add NativeWind Babel plugin

**Skia Setup:**
- Native module requiring pod install (iOS) and Gradle sync (Android)
- Verify antiAlias settings can be disabled for pixel-perfect rendering

**TypeScript Path Aliases:**
- Configure tsconfig.base.json with paths for @packages/*
- Ensure Metro resolver recognizes these aliases via metro.config.js

**MCP (Model Context Protocol) Connectors:**

MCP connectors enhance AI-assisted development by providing specialized tools and context. This project requires multiple MCP connectors for optimal development experience.

**Essential MCP Connectors:**

1. **Filesystem MCP** (Highest Priority)
   - Built-in to Claude Desktop and Claude Code
   - Enables direct file system operations (read, write, edit) across the entire codebase
   - Critical for: Creating project structure, editing components, managing configurations
   - Must verify access to: apps/, packages/, supabase/, docs/, tools/ directories
   - No API key required

2. **GitHub MCP** (High Priority)
   - Provides Git operations: repo management, branches, commits, PRs
   - Configuration: Requires GITHUB_TOKEN in .env file
   - Critical for: Version control, collaborative development, CI/CD integration
   - Token permissions needed: repo, workflow (user will provide actual token)
   - Store in .env and ensure .env is in .gitignore

3. **Firecrawl MCP** (High Priority)
   - Advanced web scraping for documentation research
   - Configuration: Requires FIRECRAWL_API_KEY in .env file
   - Use cases for this project:
     - React Native v0.71.8+ documentation
     - Phaser 3 v3.70.0 game engine docs
     - Supabase documentation (Auth, Edge Functions, Realtime, Database)
     - NativeWind v4 styling patterns and best practices
     - Reanimated 4 animation API references
     - react-native-skia custom rendering documentation
   - Superior to standard web fetch for comprehensive doc extraction
   - User will provide API key

4. **Context7 MCP**
   - Library-specific documentation for exact package versions
   - Configuration command: `claude mcp add --transport http context7 https://mcp.context7.com/mcp --header "CONTEXT7_API_KEY: your_context7_api_key_here"`
   - Provides precise API references for:
     - @react-native/* packages
     - phaser v3.70.0
     - zustand v4.x
     - react-navigation v6.x
     - All other npm dependencies
   - Enables version-specific code intelligence and suggestions

**Optional MCP Connectors:**

5. **Figma MCP** (If design files available)
   - Integrates with Figma for design file inspection
   - Configuration: Requires FIGMA_ACCESS_TOKEN in .env (if used)
   - Use cases:
     - Inspect 16BitFit prototype designs (16BitFit-Prototype-2.png reference in PRD)
     - Read design comments and annotations
     - Extract design specs (colors, spacing, typography)
   - Only configure if Figma designs are created
   - User will provide token if needed

6. **Chrome DevTools MCP** (For WebView debugging)
   - Enables debugging of Phaser game engine running inside React Native WebView
   - Critical for: Hybrid Velocity Bridge debugging, performance profiling
   - Use cases:
     - Inspect Phaser scene rendering
     - Debug bridge communication between RN and Phaser
     - Profile 60fps performance target
     - Monitor memory usage in WebView
   - Configuration details TBD based on available connector

**Environment Variables Setup:**
- Create .env file in project root for all MCP credentials
- Create .env.example with placeholder values for documentation
- Add .env to .gitignore immediately to prevent credential exposure
- User will populate actual tokens/keys in .env

**Example .env.example structure:**
```
# GitHub MCP
GITHUB_TOKEN=ghp_your_token_here

# Firecrawl MCP
FIRECRAWL_API_KEY=your_firecrawl_key_here

# Figma MCP (Optional)
FIGMA_ACCESS_TOKEN=your_figma_token_here

# Context7 already configured via CLI command
```

### Key Implementation Considerations

1. **Monorepo Setup:** Nx is recommended for managing multiple apps and shared packages. Use Nx generators where possible to maintain consistency.

2. **React Native Version:** Version 0.71.8 is specified for stability based on V2 experience. Ensure this exact version is used.

3. **Dependency Versions:** All version constraints specified in Tech Stack must be respected (e.g., Phaser ~3.70.0, Reanimated ~4.x.x).

4. **Native Dependencies:** Skia and Reanimated require native linking. Run `pod install` for iOS and Gradle sync for Android after installation.

5. **Build Verification:** Both iOS and Android builds must complete successfully before marking this story as done. This validates the entire setup.

6. **Placeholder Content:** Create a simple placeholder screen to verify the build process. UI/UX implementation comes in later stories.

7. **MCP Connector Suite:** Configure comprehensive MCP connector suite for enhanced AI-assisted development:
   - **Filesystem MCP:** Core file operations (verify built-in access)
   - **GitHub MCP:** Version control operations (requires GITHUB_TOKEN)
   - **Firecrawl MCP:** Documentation research for React Native, Phaser, Supabase, etc. (requires FIRECRAWL_API_KEY)
   - **Context7 MCP:** Library-specific API documentation (pre-configured with API key)
   - **Optional Figma MCP:** Design file access if Figma designs exist
   - **Optional Chrome DevTools MCP:** WebView debugging for Phaser bridge
   - Create .env file for credentials and .env.example for documentation
   - Essential connectors (Filesystem, GitHub, Firecrawl, Context7) must be operational before story completion

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-24 | 1.0 | Initial story draft created | SM Agent (Bob) |
| 2025-10-24 | 1.1 | Added Context7 MCP configuration task and dev notes | SM Agent (Bob) |
| 2025-10-24 | 1.2 | Expanded to comprehensive MCP connector suite: Filesystem, GitHub, Firecrawl, Context7 (essential) + Figma, Chrome DevTools (optional). Added .env setup for credentials. | SM Agent (Bob) |

## Dev Agent Record

_This section will be populated during implementation._

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_To be filled by QA agent_
