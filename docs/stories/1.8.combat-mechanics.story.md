# Story 1.8: Implement Core Combat Mechanics & Training Dummy

**Epic:** 1 - Foundation & Core Loop Setup
**Story Points:** 13
**Status:** ⏳ Pending

## User Story

**As a** Player,
**I want** my selected Combat Character (Sean/Mary) to respond to basic combat inputs (6 attacks, movement, jump, block) within the Phaser scene, and face a simple Training Dummy AI,
**so that** the fundamental fighting gameplay is functional.

## Acceptance Criteria

1. [ ] Selected Combat Character (Sean or Mary) sprite/animations are loaded into the Phaser BattleScene
2. [ ] Virtual controls (D-pad, 6 buttons) are implemented in the UI layer (React Native or Phaser overlay, matching retro style) and correctly send input commands via the bridge to Phaser
3. [ ] The Combat Character executes the corresponding basic actions (LP, MP, HP, LK, MK, HK, Walk, Jump, Block) in Phaser based on bridge commands
4. [ ] A non-attacking "Training Dummy" AI opponent is implemented in the BattleScene
5. [ ] Basic physics (gravity, collision detection between characters) are functional
6. [ ] Combat actions feel responsive (validating <50ms latency target)

## Combat Moves

### 6-Button Layout (Street Fighter style)
```
LP  MP  HP    Light Punch / Medium Punch / Heavy Punch
LK  MK  HK    Light Kick / Medium Kick / Heavy Kick
```

### Movement Controls
- D-Pad: Left/Right (Walk)
- D-Pad: Down (Crouch)
- D-Pad: Up (Jump)
- Double-tap direction: Dash
- Down + Back: Block

## Implementation

### Character Sprites

**Sean Character:**
- Idle animation (4 frames)
- Walk animation (6 frames)
- Jump animation (3 frames)
- Light Punch (3 frames)
- Medium Punch (4 frames)
- Heavy Punch (5 frames)
- Light Kick (3 frames)
- Medium Kick (4 frames)
- Heavy Kick (5 frames)
- Block (2 frames)
- Hit reaction (2 frames)

**Mary Character:** (same structure)

**Training Dummy:**
- Idle animation (2 frames)
- Hit reaction (2 frames)

### Phaser Implementation

**File:** `apps/game-engine/src/entities/Character.ts`

```typescript
export class Character extends Phaser.GameObjects.Sprite {
  private health: number = 100;
  private velocity: Phaser.Math.Vector2;
  private isBlocking: boolean = false;

  // Combat methods
  lightPunch(): void { }
  mediumPunch(): void { }
  heavyPunch(): void { }
  lightKick(): void { }
  mediumKick(): void { }
  heavyKick(): void { }

  // Movement
  moveLeft(): void { }
  moveRight(): void { }
  jump(): void { }
  block(): void { }

  // Physics
  update(delta: number): void {
    // Apply gravity
    // Handle collisions
    // Update animations
  }
}
```

**File:** `apps/game-engine/src/entities/TrainingDummy.ts`

```typescript
export class TrainingDummy extends Character {
  update(): void {
    // Stand still
    // Play idle animation
    // React to hits
  }

  onHit(damage: number): void {
    this.health -= damage;
    this.playAnimation('hit');
  }
}
```

### Virtual Controls

**File:** `apps/mobile-shell/src/components/VirtualController.tsx`

```typescript
export const VirtualController: React.FC = ({ onInput }) => {
  return (
    <View style={styles.container}>
      <DPad onPress={(direction) => onInput({ type: 'MOVE', direction })} />
      <ActionButtons
        onPunch={(strength) => onInput({ type: 'PUNCH', strength })}
        onKick={(strength) => onInput({ type: 'KICK', strength })}
      />
    </View>
  );
};
```

### Input Handling

**Bridge Messages:**
```typescript
// RN → Phaser
{
  type: 'PLAYER_INPUT',
  payload: {
    action: 'LIGHT_PUNCH' | 'HEAVY_KICK' | 'MOVE_LEFT' | ...,
    timestamp: Date.now()
  }
}

// Phaser → RN
{
  type: 'ACTION_COMPLETE',
  payload: {
    action: 'LIGHT_PUNCH',
    damage: 10,
    hitConfirmed: true
  }
}
```

## Combat Mechanics

### Damage Values
- LP: 5 damage
- MP: 10 damage
- HP: 15 damage
- LK: 7 damage
- MK: 12 damage
- HK: 18 damage

### Frame Data
- LP: 4 frames startup, 8 frames total
- MP: 6 frames startup, 12 frames total
- HP: 10 frames startup, 20 frames total
(Similar for kicks)

### Hit Detection
- Hitbox/Hurtbox collision
- Frame-perfect hit confirmation
- Knockback on heavy attacks

## Physics

```typescript
// Gravity constant
const GRAVITY = 980; // pixels/sec²

// Character physics
character.velocityY += GRAVITY * delta;
character.y += character.velocityY * delta;

// Ground collision
if (character.y >= GROUND_Y) {
  character.y = GROUND_Y;
  character.velocityY = 0;
  character.isGrounded = true;
}
```

## Testing

1. **Input Response Test:**
   - Tap each button
   - Verify character animates within 50ms

2. **Combo Test:**
   - Execute LP → MP → HP sequence
   - Verify smooth animation transitions

3. **Hit Detection:**
   - Execute attacks near dummy
   - Verify hit registration
   - Check damage numbers

4. **Movement Test:**
   - Walk left/right
   - Jump
   - Verify smooth movement

## Assets Needed

- Sean spritesheet (512x512)
- Mary spritesheet (512x512)
- Training Dummy spritesheet (256x256)
- Sound effects (punch, kick, hit)

## Dependencies

- Story 1.7 (WebView Bridge) complete
- Phaser 3 physics enabled
- Combat character selection from Story 1.6

## Next Story

**Story 1.9:** Integrate Combat UI & Step-Energy Mechanic
